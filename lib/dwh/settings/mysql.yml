# quotes and string lit
quote: "`@exp`"
string_literal: "'@exp'"

# Date functions patterns
current_date: "CURDATE()"
current_time: "CURTIME()"
current_timestamp: "NOW()"
truncate_date: "CUSTOM"
date_add: "DATE_ADD(@exp, INTERVAL @val @unit)"
date_diff: "DATEDIFF(@end_exp, @start_exp)"
date_format_sql: "DATE_FORMAT(@exp, '@format')"
date_literal: "'@val'"
date_time_literal: "'@val'"
extract_year: 'YEAR(@exp)'
extract_month: 'MONTH(@exp)'
extract_quarter: 'QUARTER(@exp)'
extract_day_of_year: 'DAYOFYEAR(@exp)'
extract_day_of_month: 'DAY(@exp)'
extract_day_of_week: 'DAYOFWEEK(@exp)'
extract_week_of_year: 'WEEK(@exp)'
extract_hour: 'HOUR(@exp)'
extract_minute: 'MINUTE(@exp)'
extract_year_month: 'CAST(CONCAT(YEAR(@exp), LPAD(MONTH(@exp), 2, "0")) AS UNSIGNED)'
default_week_start_day: "sunday"
week_start_day: "monday"
sunday_week_start_day: "DATE(DATE_SUB(@exp, INTERVAL DAYOFWEEK(@exp)-1 DAY ))"
monday_week_start_day: "DATE(DATE_SUB(@exp, INTERVAL DAYOFWEEK(@exp)-2 DAY ))"
cast: "CAST(@exp AS @type)"

# string functions
trim: "TRIM(@exp)"
lower_case: "LCASE(@exp)"
upper_case: "UCASE(@exp)"

# null handling
if_null: "COALESCE(@exp, @when_null)"
null_if: "NULLIF(@exp, @target)"
null_if_zero: "NULLIF(@exp, 0)"

# Relevant db capabilities for query gen
supports_table_join: true
supports_full_join: false # MySQL doesn't support FULL OUTER JOIN
supports_cross_join: true
supports_sub_queries: true
supports_common_table_expressions: true # MySQL 8.0+
supports_temp_tables: true
create_temp_table_template: "CREATE TEMPORARY TABLE @table AS \n@sql"
supports_window_functions: true # MySQL 8.0+
extend_ending_date_to_last_hour_of_day: false

# array operations (MySQL has limited array support, using JSON functions for MySQL 8.0+)
array_in_list: "JSON_OVERLAPS(@exp, JSON_ARRAY(@list))" # MySQL 8.0.17+
array_exclude_list: "NOT JSON_OVERLAPS(@exp, JSON_ARRAY(@list))" # MySQL 8.0.17+
array_unnest_join: "JOIN JSON_TABLE(@exp, '$[*]' COLUMNS (@alias JSON PATH '$')) AS @alias"

cross_join: "CROSS JOIN @relation"

# sql output behavior
temp_table_type: "cte" # options cte, subquery, temp
temp_table_prefix: ""

# Determines how measures across fact universes are combined.
final_pass_measure_join_type: "left" # inner left right etc
apply_advanced_filtering_on_array_projections: false
greedy_apply_date_filters: true
cross_universe_measure_filtering_strategy: "both" # both, final, intermediate
